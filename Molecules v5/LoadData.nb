(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.3' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     31804,        731]
NotebookOptionsPosition[     31475,        717]
NotebookOutlinePosition[     31848,        733]
CellTagsIndexPosition[     31805,        730]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"GetData", "[", "n_", "]"}], ":=", 
   RowBox[{"(", "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"name", "=", "n"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"Sep", "[", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Print", "[", 
      RowBox[{"\"\<Working on: \>\"", ",", "name"}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"APrint", "[", "\"\<Getting informations..\>\"", "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"dt", "=", 
      RowBox[{"n", "/.", "data"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"els", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"GetEls", "[", "name", "]"}], "/.", 
        RowBox[{"\"\<T\>\"", "\[Rule]", "\"\<H\>\""}]}], "/.", 
       RowBox[{"\"\<D\>\"", "\[Rule]", "\"\<H\>\""}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"elsx", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"GetElsx", "[", "name", "]"}], "/.", 
        RowBox[{"\"\<T\>\"", "\[Rule]", "\"\<H\>\""}]}], "/.", 
       RowBox[{"\"\<D\>\"", "\[Rule]", "\"\<H\>\""}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"objs", "=", 
      RowBox[{"elsx", "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"msgs", "=", 
      RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"control", "=", "True"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"Quiet", "[", 
      RowBox[{"wdata", "=", 
       RowBox[{"Check", "[", 
        RowBox[{
         RowBox[{"ChemicalData", "[", "name", "]"}], ",", "0"}], "]"}]}], 
      "]"}], ";", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"NumberQ", "[", "wdata", "]"}], ",", 
       RowBox[{"APrint", "[", 
        RowBox[{
        "\"\<Wolfram data for \>\"", "<>", "name", "<>", " ", 
         "\"\<unavailable\>\""}], "]"}], "\[IndentingNewLine]", ",", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"molecule", "=", 
         RowBox[{"<|", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"\"\<atcnt\>\"", "\[Rule]", 
            RowBox[{"QE", "[", 
             RowBox[{"\"\<atcnt\>\"", "/.", "dt"}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"\"\<ei\>\"", "\[Rule]", 
            RowBox[{"QE", "[", 
             RowBox[{"\"\<ion\>\"", "/.", "dt"}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"\"\<dm\>\"", "\[Rule]", 
            RowBox[{
             RowBox[{"QE", "[", 
              RowBox[{"\"\<dip\>\"", "/.", "dt"}], "]"}], "*", "deb"}]}], ",",
            "\[IndentingNewLine]", 
           RowBox[{"\"\<ms\>\"", "\[Rule]", 
            RowBox[{"QE", "[", 
             RowBox[{"\"\<magn\>\"", "/.", "dt"}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"\"\<freq\>\"", "\[Rule]", 
            RowBox[{"QE", "[", 
             RowBox[{"\"\<freq\>\"", "/.", "dt"}], "]"}]}]}], 
          "\[IndentingNewLine]", "|>"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"bonds", "=", 
         RowBox[{"Association", "[", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"k", "=", 
            RowBox[{"i", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"bonds", "[", "k", "]"}], "=", 
            RowBox[{"Association", "[", "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"bonds", "[", "k", "]"}], "[", "\"\<crg\>\"", "]"}], "=",
             "0"}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"bonds", "[", "k", "]"}], "[", "\"\<eles\>\"", "]"}], 
            "=", 
            RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"bonds", "[", "k", "]"}], "[", "\"\<elem\>\"", "]"}], 
            "=", 
            RowBox[{"i", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"bonds", "[", "k", "]"}], "[", "\"\<tv\>\"", "]"}], "=", 
            RowBox[{"GetGr", "[", 
             RowBox[{"QM", "[", 
              RowBox[{"ElementData", "[", 
               RowBox[{
                RowBox[{"i", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], ",", "\"\<Group\>\""}], 
               "]"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"bonds", "[", "k", "]"}], "[", "\"\<pv\>\"", "]"}], "=", 
            RowBox[{"ElementData", "[", 
             RowBox[{
              RowBox[{"i", "[", 
               RowBox[{"[", "2", "]"}], "]"}], ",", "\"\<Valence\>\""}], 
             "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"bonds", "[", "k", "]"}], "[", "\"\<rr\>\"", "]"}], "=", 
            RowBox[{"QM", "[", 
             RowBox[{"ElementData", "[", 
              RowBox[{
               RowBox[{"i", "[", 
                RowBox[{"[", "2", "]"}], "]"}], ",", "\"\<AtomicRadius\>\""}],
               "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"bonds", "[", "k", "]"}], "[", "\"\<ma\>\"", "]"}], "=", 
            RowBox[{"QM", "[", 
             RowBox[{"ElementData", "[", 
              RowBox[{
               RowBox[{"i", "[", 
                RowBox[{"[", "2", "]"}], "]"}], ",", "\"\<AtomicWeight\>\""}],
               "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", ",", 
          "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{"i", ",", "elsx"}], "}"}]}], "\[IndentingNewLine]", "]"}], 
        ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"\"\<leftv\>\"", "/.", "dt"}], ")"}], "\[NotEqual]", 
           "\"\<leftv\>\""}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Bupd", "[", 
            RowBox[{
             RowBox[{"elsx", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
             RowBox[{"elsx", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "1"}], "]"}], "]"}], ",", "\"\<var\>\"", ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"QE", "[", 
                RowBox[{"\"\<leftv\>\"", "/.", "dt"}], "]"}], ",", 
               RowBox[{"QE", "[", 
                RowBox[{"\"\<rightv\>\"", "/.", "dt"}], "]"}]}], "}"}]}], 
            "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"\"\<simlen\>\"", "/.", "dt"}], ")"}], "\[NotEqual]", 
           "\"\<simlen\>\""}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Bupd", "[", 
            RowBox[{
             RowBox[{"elsx", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
             RowBox[{"elsx", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "1"}], "]"}], "]"}], ",", "\"\<len\>\"", ",", 
             RowBox[{"QE", "[", 
              RowBox[{"\"\<simlen\>\"", "/.", "dt"}], "]"}]}], "]"}], ";"}]}],
          "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"\"\<dis\>\"", "/.", "dt"}], ")"}], "\[NotEqual]", 
           "\"\<dis\>\""}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Bupd", "[", 
            RowBox[{
             RowBox[{"elsx", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
             RowBox[{"elsx", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "1"}], "]"}], "]"}], ",", "\"\<dis\>\"", ",", 
             RowBox[{"QE", "[", 
              RowBox[{"\"\<dis\>\"", "/.", "dt"}], "]"}]}], "]"}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"StringContainsQ", "[", 
               RowBox[{"i", ",", "\"\<\[Angle]\>\""}], "]"}], "&&", 
              RowBox[{"!", 
               RowBox[{"StringContainsQ", "[", 
                RowBox[{"i", ",", "\"\<src\>\""}], "]"}]}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"atoms", "=", 
               RowBox[{"GetEls", "[", "i", "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"buff", "=", 
               RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"as", "=", 
               RowBox[{"bs", "=", 
                RowBox[{"cs", "=", "False"}]}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"Do", "[", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"j", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "\[Equal]", 
                    RowBox[{"atoms", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "&&", 
                    RowBox[{"!", 
                    RowBox[{"MemberQ", "[", 
                    RowBox[{"buff", ",", 
                    RowBox[{"j", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], "&&", 
                    RowBox[{"!", "as"}]}], ",", "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{"atoma", "=", 
                    RowBox[{"j", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"AppendTo", "[", 
                    RowBox[{"buff", ",", 
                    RowBox[{"j", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"as", "=", "True"}], ";"}]}], 
                  "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"j", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "\[Equal]", 
                    RowBox[{"atoms", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "&&", 
                    RowBox[{"!", 
                    RowBox[{"MemberQ", "[", 
                    RowBox[{"buff", ",", 
                    RowBox[{"j", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], "&&", 
                    RowBox[{"!", "bs"}]}], ",", "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{"atomb", "=", 
                    RowBox[{"j", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"AppendTo", "[", 
                    RowBox[{"buff", ",", 
                    RowBox[{"j", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"bs", "=", "True"}], ";"}]}], 
                  "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"j", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "\[Equal]", 
                    RowBox[{"atoms", "[", 
                    RowBox[{"[", "3", "]"}], "]"}]}], "&&", 
                    RowBox[{"!", 
                    RowBox[{"MemberQ", "[", 
                    RowBox[{"buff", ",", 
                    RowBox[{"j", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], "&&", 
                    RowBox[{"!", "cs"}]}], ",", "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{"atomc", "=", 
                    RowBox[{"j", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"AppendTo", "[", 
                    RowBox[{"buff", ",", 
                    RowBox[{"j", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"cs", "=", "True"}], ";"}]}], 
                  "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", 
                ",", "\[IndentingNewLine]", 
                RowBox[{"{", 
                 RowBox[{"j", ",", "elsx"}], "}"}]}], "\[IndentingNewLine]", 
               "]"}], ";", "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"!", 
                 RowBox[{"KeyExistsQ", "[", 
                  RowBox[{
                   RowBox[{"bonds", "[", "atomb", "]"}], ",", "\"\<ang\>\""}],
                   "]"}]}], ",", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                  RowBox[{"bonds", "[", "atomb", "]"}], "[", "\"\<ang\>\"", 
                  "]"}], "=", 
                 RowBox[{"{", 
                  RowBox[{"{", 
                   RowBox[{"atoma", ",", "atomc", ",", 
                    RowBox[{"QE", "[", 
                    RowBox[{"i", "/.", "dt"}], "]"}]}], "}"}], "}"}]}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{"AppendTo", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"bonds", "[", "atomb", "]"}], "[", "\"\<ang\>\"", 
                   "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"atoma", ",", "atomc", ",", 
                    RowBox[{"QE", "[", 
                    RowBox[{"i", "/.", "dt"}], "]"}]}], "}"}]}], "]"}]}], 
               "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}],
            ";", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"StringContainsQ", "[", 
               RowBox[{"i", ",", "\"\<\[LongDash]\>\""}], "]"}], "&&", 
              RowBox[{"!", 
               RowBox[{"StringContainsQ", "[", 
                RowBox[{"i", ",", "\"\<src\>\""}], "]"}]}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"atoms", "=", 
               RowBox[{"GetBond", "[", 
                RowBox[{"i", ",", "\"\<\[LongDash]\>\""}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"alist", "=", 
               RowBox[{"blist", "=", 
                RowBox[{"{", "}"}]}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"Do", "[", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"j", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "\[Equal]", 
                    RowBox[{"atoms", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ",", 
                   "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{"AppendTo", "[", 
                    RowBox[{"alist", ",", 
                    RowBox[{"j", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ";"}]}], 
                  "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"j", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "\[Equal]", 
                    RowBox[{"atoms", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], ",", 
                   "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{"AppendTo", "[", 
                    RowBox[{"blist", ",", 
                    RowBox[{"j", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ";"}]}], 
                  "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", 
                ",", "\[IndentingNewLine]", 
                RowBox[{"{", 
                 RowBox[{"j", ",", "elsx"}], "}"}]}], "\[IndentingNewLine]", 
               "]"}], ";", "\[IndentingNewLine]", 
              RowBox[{"Do", "[", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{"Bupd", "[", 
                  RowBox[{
                   RowBox[{"k", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                   RowBox[{"k", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ",", "\"\<len\>\"", ",", 
                   RowBox[{"QE", "[", 
                    RowBox[{"i", "/.", "dt"}], "]"}]}], "]"}], ";"}], 
                "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
                RowBox[{"{", 
                 RowBox[{"k", ",", 
                  RowBox[{"Tuples", "[", 
                   RowBox[{"{", 
                    RowBox[{"alist", ",", "blist"}], "}"}], "]"}]}], "}"}]}], 
               "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}],
            ";", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"StringContainsQ", "[", 
               RowBox[{"i", ",", "\"\<&\>\""}], "]"}], "&&", 
              RowBox[{"!", 
               RowBox[{"StringContainsQ", "[", 
                RowBox[{"i", ",", "\"\<src\>\""}], "]"}]}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"atoms", "=", 
               RowBox[{"GetBond", "[", 
                RowBox[{"i", ",", "\"\<&\>\""}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"alist", "=", 
               RowBox[{"blist", "=", 
                RowBox[{"{", "}"}]}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"Do", "[", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"j", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "\[Equal]", 
                    RowBox[{"atoms", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ",", 
                   "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{"AppendTo", "[", 
                    RowBox[{"alist", ",", 
                    RowBox[{"j", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ";"}]}], 
                  "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"j", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "\[Equal]", 
                    RowBox[{"atoms", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], ",", 
                   "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{"AppendTo", "[", 
                    RowBox[{"blist", ",", 
                    RowBox[{"j", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ";"}]}], 
                  "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", 
                ",", "\[IndentingNewLine]", 
                RowBox[{"{", 
                 RowBox[{"j", ",", "elsx"}], "}"}]}], "\[IndentingNewLine]", 
               "]"}], ";", "\[IndentingNewLine]", 
              RowBox[{"Do", "[", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{"Bupd", "[", 
                  RowBox[{
                   RowBox[{"k", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                   RowBox[{"k", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ",", "\"\<dis\>\"", ",", 
                   RowBox[{"QE", "[", 
                    RowBox[{"i", "/.", "dt"}], "]"}]}], "]"}], ";"}], 
                "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
                RowBox[{"{", 
                 RowBox[{"k", ",", 
                  RowBox[{"Tuples", "[", 
                   RowBox[{"{", 
                    RowBox[{"alist", ",", "blist"}], "}"}], "]"}]}], "}"}]}], 
               "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}],
            ";", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"StringContainsQ", "[", 
               RowBox[{"i", ",", "\"\<#\>\""}], "]"}], "&&", 
              RowBox[{"!", 
               RowBox[{"StringContainsQ", "[", 
                RowBox[{"i", ",", "\"\<src\>\""}], "]"}]}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"atoms", "=", 
               RowBox[{"GetBond", "[", 
                RowBox[{"i", ",", "\"\<#\>\""}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"alist", "=", 
               RowBox[{"blist", "=", 
                RowBox[{"{", "}"}]}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"Do", "[", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"j", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "\[Equal]", 
                    RowBox[{"atoms", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ",", 
                   "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{"AppendTo", "[", 
                    RowBox[{"alist", ",", 
                    RowBox[{"j", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ";"}]}], 
                  "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"j", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "\[Equal]", 
                    RowBox[{"atoms", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], ",", 
                   "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{"AppendTo", "[", 
                    RowBox[{"blist", ",", 
                    RowBox[{"j", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ";"}]}], 
                  "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", 
                ",", "\[IndentingNewLine]", 
                RowBox[{"{", 
                 RowBox[{"j", ",", "elsx"}], "}"}]}], "\[IndentingNewLine]", 
               "]"}], ";", "\[IndentingNewLine]", 
              RowBox[{"Do", "[", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{"Bupd", "[", 
                  RowBox[{
                   RowBox[{"k", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                   RowBox[{"k", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ",", "\"\<var\>\"", ",", 
                   RowBox[{"QE", "[", 
                    RowBox[{"i", "/.", "dt"}], "]"}]}], "]"}], ";"}], 
                "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
                RowBox[{"{", 
                 RowBox[{"k", ",", 
                  RowBox[{"Tuples", "[", 
                   RowBox[{"{", 
                    RowBox[{"alist", ",", "blist"}], "}"}], "]"}]}], "}"}]}], 
               "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}],
            ";"}], "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"dt", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", "1"}], "]"}], "]"}]}], "}"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"Which", "[", " ", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"QN", "[", 
            RowBox[{"molecule", "[", "\"\<ei\>\"", "]"}], "]"}], "\[Equal]", 
           "\"\<ion\>\""}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"control", "=", "False"}], ";", "\[IndentingNewLine]", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"msgs", ",", "\"\<Error: Missing Ionisation\>\""}], 
            "]"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"QN", "[", 
            RowBox[{"molecule", "[", "\"\<dm\>\"", "]"}], "]"}], "\[Equal]", 
           "\"\<dip\>\""}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"control", "=", "False"}], ";", "\[IndentingNewLine]", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"msgs", ",", "\"\<Error: Missing Dipole Moment\>\""}], 
            "]"}]}]}], "\[IndentingNewLine]", "]"}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"k", "=", 
            RowBox[{"i", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"!", 
              RowBox[{"KeyExistsQ", "[", 
               RowBox[{
                RowBox[{"bonds", "[", "k", "]"}], ",", "\"\<dt\>\""}], 
               "]"}]}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"control", "=", "False"}], ";", "\[IndentingNewLine]", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"msgs", ",", 
                RowBox[{"\"\<Error: Missing bond for \>\"", "<>", "k"}]}], 
               "]"}], ";", "\[IndentingNewLine]", 
              RowBox[{"Break", "[", "]"}], ";"}]}], "\[IndentingNewLine]", 
            "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"Length", "[", 
                RowBox[{
                 RowBox[{"bonds", "[", "k", "]"}], "[", "\"\<dt\>\"", "]"}], 
                "]"}], ">", "1"}], "&&", 
              RowBox[{"!", 
               RowBox[{"KeyExistsQ", "[", 
                RowBox[{
                 RowBox[{"bonds", "[", "k", "]"}], ",", "\"\<ang\>\""}], 
                "]"}]}]}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"control", "=", "False"}], ";", "\[IndentingNewLine]", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"msgs", ",", 
                RowBox[{"\"\<Error: Missing angle in \>\"", "<>", "k"}]}], 
               "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"Do", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Which", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"!", 
                RowBox[{"KeyExistsQ", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"bonds", "[", "k", "]"}], "[", "j", "]"}], ",", 
                  "\"\<dv\>\""}], "]"}]}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"Bupd", "[", 
                 RowBox[{"k", ",", "j", ",", "\"\<var\>\"", ",", 
                  RowBox[{"Table", "[", 
                   RowBox[{
                    RowBox[{"Min", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"bonds", "[", "k", "]"}], "[", "\"\<pv\>\"", 
                    "]"}], ",", 
                    RowBox[{
                    RowBox[{"bonds", "[", "j", "]"}], "[", "\"\<pv\>\"", 
                    "]"}]}], "]"}], ",", "2"}], "]"}]}], "]"}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"AppendTo", "[", 
                 RowBox[{"msgs", ",", 
                  RowBox[{
                  "\"\<Warning: automatic valency between \>\"", "<>", "k", 
                   "<>", "\"\< and \>\"", "<>", "j"}]}], "]"}]}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"!", 
                RowBox[{"KeyExistsQ", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"bonds", "[", "k", "]"}], "[", "j", "]"}], ",", 
                  "\"\<ln\>\""}], "]"}]}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"control", "=", "False"}], ";", "\[IndentingNewLine]", 
                RowBox[{"AppendTo", "[", 
                 RowBox[{"msgs", ",", 
                  RowBox[{
                  "\"\<Error: Missing length for \>\"", "<>", "k", "<>", 
                   "\"\< and \>\"", "<>", "j"}]}], "]"}]}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"!", 
                RowBox[{"KeyExistsQ", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"bonds", "[", "k", "]"}], "[", "j", "]"}], ",", 
                  "\"\<ds\>\""}], "]"}]}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"control", "=", "False"}], ";", "\[IndentingNewLine]", 
                RowBox[{"AppendTo", "[", 
                 RowBox[{"msgs", ",", 
                  RowBox[{
                  "\"\<Error: Missing dissociation for \>\"", "<>", "k", 
                   "<>", "\"\< and \>\"", "<>", "j"}]}], "]"}], ";"}]}], 
              "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", ",", 
             "\[IndentingNewLine]", 
             RowBox[{"{", 
              RowBox[{"j", ",", 
               RowBox[{
                RowBox[{"bonds", "[", "k", "]"}], "[", "\"\<dt\>\"", "]"}]}], 
              "}"}]}], "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
          ",", "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{"i", ",", "elsx"}], "}"}]}], "\[IndentingNewLine]", "]"}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"Return", "[", 
         RowBox[{"{", 
          RowBox[{"control", ",", "msgs"}], "}"}], "]"}], ";"}]}], 
      "\[IndentingNewLine]"}]}]}]}], ")"}]], "Input",
 CellChangeTimes->{{3.7929156693591595`*^9, 3.792915679753058*^9}, {
  3.7929157104798727`*^9, 3.792915829562309*^9}, {3.79291586170935*^9, 
  3.79291598539007*^9}},ExpressionUUID->"a38efd12-1907-4c70-9a83-\
5d02c8484cdf"]
},
WindowSize->{775, 872},
WindowMargins->{{Automatic, 104}, {53, Automatic}},
Magnification:>1.3 Inherited,
FrontEndVersion->"11.3 for Microsoft Windows (64-bit) (March 6, 2018)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 30913, 695, 4738, "Input",ExpressionUUID->"a38efd12-1907-4c70-9a83-5d02c8484cdf"]
}
]
*)

