(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.3' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     39091,        755]
NotebookOptionsPosition[     38791,        742]
NotebookOutlinePosition[     39135,        757]
CellTagsIndexPosition[     39092,        754]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"SetGeometry", "[", "]"}], ":=", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"APrint", "[", "\"\<Preparing calculations..\>\"", "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"KER", "=", 
      RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"We", "[", 
       RowBox[{"obj_", ",", "par_", ",", "pos_"}], "]"}], ":=", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"bonds", "[", "obj", "]"}], "[", "\"\<pos\>\"", "]"}], "=",
           "pos"}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"KeyExistsQ", "[", 
            RowBox[{
             RowBox[{"bonds", "[", "obj", "]"}], ",", "\"\<ang\>\""}], "]"}], 
           ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Do", "[", "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"par", "\[NotEqual]", "\"\<\>\""}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"Which", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"i", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "par"}], ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{"dest", "=", 
                  RowBox[{"i", "[", 
                   RowBox[{"[", "2", "]"}], "]"}]}], ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"i", "[", 
                   RowBox[{"[", "2", "]"}], "]"}], "\[Equal]", "par"}], ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{"dest", "=", 
                  RowBox[{"i", "[", 
                   RowBox[{"[", "1", "]"}], "]"}]}]}], "\[IndentingNewLine]", 
                "]"}], "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
               RowBox[{"{", 
                RowBox[{"i", ",", 
                 RowBox[{
                  RowBox[{"bonds", "[", "obj", "]"}], "[", "\"\<ang\>\"", 
                  "]"}]}], "}"}]}], "\[IndentingNewLine]", "]"}], 
             "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{"We", "[", 
             RowBox[{
              RowBox[{"objs", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", "\"\<\>\"", ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", "0"}], "}"}]}], "]"}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"st", "=", 
             RowBox[{"objs", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"While", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Length", "[", "KER", "]"}], "\[Equal]", "0"}], ",",
                  "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"pos", "=", 
                   RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "0"}], "}"}]}], ";"}], 
                 "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{"!", 
                    RowBox[{"KeyExistsQ", "[", 
                    RowBox[{
                    RowBox[{"bonds", "[", "i", "]"}], ",", "\"\<an\>\""}], 
                    "]"}]}], ",", "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{"pos", "=", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"bonds", "[", "i", "]"}], "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"bonds", "[", "i", "]"}], "[", "\"\<dt\>\"", 
                    "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "[", "\"\<ln\>\"", 
                    "]"}], ",", "0", ",", "0"}], "}"}]}], ";"}]}], 
                  "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
                "]"}], ";", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{"bonds", "[", "i", "]"}], "[", "\"\<pos\>\"", "]"}], 
                "=", "pos"}], ";", "\[IndentingNewLine]", 
               RowBox[{"crg", "=", "0"}], ";", "\[IndentingNewLine]", 
               RowBox[{"Do", "[", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                  RowBox[{"crg", "+=", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"bonds", "[", "i", "]"}], "[", "j", "]"}], "[", 
                    "\"\<lv\>\"", "]"}]}], ";"}], "\[IndentingNewLine]", ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{"{", 
                  RowBox[{"j", ",", 
                   RowBox[{
                    RowBox[{"bonds", "[", "i", "]"}], "[", "\"\<dt\>\"", 
                    "]"}]}], "}"}]}], "\[IndentingNewLine]", "]"}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{"bonds", "[", "i", "]"}], "[", "\"\<crg\>\"", "]"}], 
                "=", "crg"}], ";", "\[IndentingNewLine]", 
               RowBox[{"AppendTo", "[", 
                RowBox[{"KER", ",", 
                 RowBox[{"{", 
                  RowBox[{"pos", ",", "crg", ",", "i", ",", 
                   RowBox[{
                    RowBox[{"bonds", "[", "i", "]"}], "[", "\"\<ma\>\"", 
                    "]"}], ",", "i"}], "}"}]}], "]"}], ";"}], 
              "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
              RowBox[{"{", 
               RowBox[{"i", ",", "objs"}], "}"}]}], "\[IndentingNewLine]", 
             "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"Do", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"bonds", "[", "i", "]"}], "[", "\"\<eles\>\"", "]"}],
                 "=", 
                RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{"bonds", "[", "i", "]"}], "[", "\"\<az\>\"", "]"}], 
                "=", 
                RowBox[{"<|", "|>"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"Do", "[", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"bonds", "[", "i", "]"}], "[", "\"\<az\>\"", 
                    "]"}], "[", "j", "]"}], "=", "False"}], ";"}], 
                 "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
                 RowBox[{"{", 
                  RowBox[{"j", ",", 
                   RowBox[{
                    RowBox[{"bonds", "[", "i", "]"}], "[", "\"\<dt\>\"", 
                    "]"}]}], "}"}]}], "\[IndentingNewLine]", "]"}]}], 
              "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
              RowBox[{"{", 
               RowBox[{"i", ",", "objs"}], "}"}]}], "\[IndentingNewLine]", 
             "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"eles", "=", 
             RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{"Do", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Do", "[", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"bonds", "[", "i", "]"}], "[", "\"\<az\>\"", 
                    "]"}], "[", "j", "]"}], ",", 
                   RowBox[{"Continue", "[", "]"}]}], "]"}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"vec", "=", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"bonds", "[", "j", "]"}], "[", "\"\<pos\>\"", 
                    "]"}], "-", 
                   RowBox[{
                    RowBox[{"bonds", "[", "i", "]"}], "[", "\"\<pos\>\"", 
                    "]"}]}]}], ";", "\[IndentingNewLine]", 
                 RowBox[{"len", "=", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"bonds", "[", "i", "]"}], "[", "j", "]"}], "[", 
                   "\"\<ln\>\"", "]"}]}], ";", "\[IndentingNewLine]", 
                 RowBox[{"dv", "=", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"bonds", "[", "i", "]"}], "[", "j", "]"}], "[", 
                   "\"\<dv\>\"", "]"}]}], ";", "\[IndentingNewLine]", 
                 RowBox[{"lv", "=", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"bonds", "[", "i", "]"}], "[", "j", "]"}], "[", 
                   "\"\<lv\>\"", "]"}]}], ";", "\[IndentingNewLine]", 
                 "\[IndentingNewLine]", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"molecule", "[", "\"\<atcnt\>\"", "]"}], 
                    "\[Equal]", "2"}], "&&", 
                    RowBox[{
                    RowBox[{"molecule", "[", "\"\<dm\>\"", "]"}], "\[Equal]", 
                    "0"}]}], ",", 
                   RowBox[{"xa", "=", 
                    FractionBox["len", "2"]}]}], "]"}], ";", 
                 "\[IndentingNewLine]", "\[IndentingNewLine]", 
                 RowBox[{"xx", "=", 
                  RowBox[{"{", 
                   RowBox[{"xa", ",", "ya", ",", "0"}], "}"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"xy", "=", 
                  RowBox[{"{", 
                   RowBox[{"xa", ",", "ya", ",", "0"}], "}"}]}], ";", 
                 "\[IndentingNewLine]", "\[IndentingNewLine]", 
                 RowBox[{"xf", "=", 
                  RowBox[{"Which", "[", "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{"lv", "\[Equal]", "dv"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"Range", "[", 
                    RowBox[{"0", ",", 
                    RowBox[{
                    RowBox[{"2", "*", "dv"}], "-", "1"}], ",", "2"}], "]"}], 
                    ",", "\[IndentingNewLine]", 
                    RowBox[{"lv", "<", "dv"}], ",", "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"dv", "\[Equal]", "1"}], ",", 
                    RowBox[{"{", "}"}], ",", 
                    RowBox[{"xf", "=", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "3"}], "}"}]}]}], "]"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"lv", ">", "dv"}], ",", "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"dv", "\[Equal]", "1"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "1"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2", ",", "4", ",", "5"}], "}"}]}], 
                    "]"}]}], "\[IndentingNewLine]", "]"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"xg", "=", 
                  RowBox[{"Complement", "[", 
                   RowBox[{
                    RowBox[{"Range", "[", 
                    RowBox[{"0", ",", 
                    RowBox[{
                    RowBox[{"2", "dv"}], "-", "1"}]}], "]"}], ",", "xf"}], 
                   "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
                 RowBox[{"f", "=", 
                  RowBox[{"RotationTransform", "[", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"len", ",", "0", ",", "0"}], "}"}], ",", "vec"}], 
                    "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
                 RowBox[{"Do", "[", "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"v", "=", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"bonds", "[", "i", "]"}], "[", "\"\<pos\>\"", 
                    "]"}], "+", 
                    RowBox[{"f", "[", 
                    RowBox[{"Rot", "[", 
                    RowBox[{"xx", ",", 
                    RowBox[{"af", "*", 
                    FractionBox["\[Pi]", "dv"]}], ",", "1"}], "]"}], 
                    "]"}]}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"AppendTo", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"bonds", "[", "i", "]"}], "[", "\"\<eles\>\"", 
                    "]"}], ",", "v"}], "]"}], ";", "\[IndentingNewLine]", 
                    RowBox[{"AppendTo", "[", 
                    RowBox[{"eles", ",", 
                    RowBox[{"{", 
                    RowBox[{"v", ",", 
                    RowBox[{"-", "1"}], ",", "i", ",", "me", ",", 
                    "\"\<FDF\>\""}], "}"}]}], "]"}], ";"}], 
                   "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
                   RowBox[{"{", 
                    RowBox[{"af", ",", "xf"}], "}"}]}], "\[IndentingNewLine]",
                   "]"}], ";", "\[IndentingNewLine]", 
                 RowBox[{"Do", "[", "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"v", "=", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"bonds", "[", "i", "]"}], "[", "\"\<pos\>\"", 
                    "]"}], "+", 
                    RowBox[{"f", "[", 
                    RowBox[{"Rot", "[", 
                    RowBox[{"xy", ",", 
                    RowBox[{"af", "*", 
                    FractionBox["\[Pi]", "dv"]}], ",", "1"}], "]"}], 
                    "]"}]}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"AppendTo", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"bonds", "[", "j", "]"}], "[", "\"\<eles\>\"", 
                    "]"}], ",", "v"}], "]"}], ";", "\[IndentingNewLine]", 
                    RowBox[{"AppendTo", "[", 
                    RowBox[{"eles", ",", 
                    RowBox[{"{", 
                    RowBox[{"v", ",", 
                    RowBox[{"-", "1"}], ",", "j", ",", "me", ",", 
                    "\"\<FDF\>\""}], "}"}]}], "]"}], ";"}], 
                   "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
                   RowBox[{"{", 
                    RowBox[{"af", ",", "xg"}], "}"}]}], "\[IndentingNewLine]",
                   "]"}], ";", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"bonds", "[", "i", "]"}], "[", "\"\<az\>\"", 
                    "]"}], "[", "j", "]"}], "=", "True"}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"bonds", "[", "j", "]"}], "[", "\"\<az\>\"", 
                    "]"}], "[", "i", "]"}], "=", "True"}], ";"}], 
                "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
                RowBox[{"{", 
                 RowBox[{"j", ",", 
                  RowBox[{
                   RowBox[{"bonds", "[", "i", "]"}], "[", "\"\<dt\>\"", 
                   "]"}]}], "}"}]}], "\[IndentingNewLine]", "]"}], 
              "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
              RowBox[{"{", 
               RowBox[{"i", ",", "objs"}], "}"}]}], "\[IndentingNewLine]", 
             "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{"grules", "=", 
             RowBox[{"{", "\[IndentingNewLine]", 
              RowBox[{"0", "<", "xa", "<", "len"}], "\[IndentingNewLine]", 
              "}"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"srules", "=", 
             RowBox[{"{", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"{", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                  RowBox[{"0.5", "len"}], "<", "ya", "<", 
                  RowBox[{"1.25", "len"}]}], "\[IndentingNewLine]", ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{"0", "<", "\[Kappa]", "<", "0.75"}]}], 
                "\[IndentingNewLine]", "}"}], "\[IndentingNewLine]", ",", 
               "\[IndentingNewLine]", 
               RowBox[{"{", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                  RowBox[{"0.5", "len"}], "<", "ya", "<", 
                  RowBox[{"1.25", "len"}]}], "\[IndentingNewLine]", ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{"0.75", "<", "\[Kappa]", "<", "10"}]}], 
                "\[IndentingNewLine]", "}"}], "\[IndentingNewLine]", ",", 
               "\[IndentingNewLine]", 
               RowBox[{"{", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                  RowBox[{"1.25", "len"}], "<", "ya", "<", 
                  RowBox[{"1.75", "len"}]}], "\[IndentingNewLine]", ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{"0", "<", "\[Kappa]", "<", "0.75"}]}], 
                "\[IndentingNewLine]", "}"}], "\[IndentingNewLine]", ",", 
               "\[IndentingNewLine]", 
               RowBox[{"{", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                  RowBox[{"1.25", "len"}], "<", "ya", "<", 
                  RowBox[{"1.75", "len"}]}], "\[IndentingNewLine]", ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{"0.75", "<", "\[Kappa]", "<", "10"}]}], 
                "\[IndentingNewLine]", "}"}], "\[IndentingNewLine]", ",", 
               "\[IndentingNewLine]", 
               RowBox[{"{", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                  RowBox[{"0.15", "len"}], "<", "ya", "<", 
                  RowBox[{"0.5", "len"}]}], "\[IndentingNewLine]", ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{"0", "<", "\[Kappa]", "<", "0.75"}]}], 
                "\[IndentingNewLine]", "}"}], "\[IndentingNewLine]", ",", 
               "\[IndentingNewLine]", 
               RowBox[{"{", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                  RowBox[{"0.15", "len"}], "<", "ya", "<", 
                  RowBox[{"0.5", "len"}]}], "\[IndentingNewLine]", ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{"0.75", "<", "\[Kappa]", "<", "10"}]}], 
                "\[IndentingNewLine]", "}"}], "\[IndentingNewLine]", ",", 
               "\[IndentingNewLine]", 
               RowBox[{"{", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"0", "<", "ya", "<", 
                  RowBox[{"0.15", "len"}]}], "\[IndentingNewLine]", ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{"0", "<", "\[Kappa]", "<", "10"}]}], 
                "\[IndentingNewLine]", "}"}], "\[IndentingNewLine]", ",", 
               "\[IndentingNewLine]", 
               RowBox[{"{", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                  RowBox[{"1.75", "len"}], "<", "ya", "<", 
                  RowBox[{"2", "len"}]}], "\[IndentingNewLine]", ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{"0", "<", "\[Kappa]", "<", "10"}]}], 
                "\[IndentingNewLine]", "}"}], "\[IndentingNewLine]", ",", 
               "\[IndentingNewLine]", 
               RowBox[{"{", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                  RowBox[{"1.75", "len"}], "<", "ya", "<", 
                  RowBox[{"2", "len"}]}], "\[IndentingNewLine]", ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{"0", "<", "\[Kappa]", "<", "10"}]}], 
                "\[IndentingNewLine]", "}"}], "\[IndentingNewLine]", ",", 
               "\[IndentingNewLine]", 
               RowBox[{"{", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                  RowBox[{"2", "len"}], "<", "ya", "<", 
                  RowBox[{"3", "len"}]}], "\[IndentingNewLine]", ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{"0", "<", "\[Kappa]", "<", "10"}]}], 
                "\[IndentingNewLine]", "}"}]}], "\[IndentingNewLine]", 
              "}"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"rules", "=", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"Join", "[", 
                RowBox[{"i", ",", "grules"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "srules"}], "}"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"io", "=", 
             RowBox[{"eles", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{"mq", "=", 
             RowBox[{"pq", "=", 
              RowBox[{"i1q", "=", 
               RowBox[{"i2q", "=", 
                RowBox[{"dq", "=", 
                 RowBox[{"Join", "[", 
                  RowBox[{"KER", ",", "eles"}], "]"}]}]}]}]}]}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"ListDis", "=", 
             RowBox[{"<|", "|>"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"Do", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Do", "[", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{"test", "=", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"bonds", "[", "i", "]"}], "[", "j", "]"}], "[", 
                   "\"\<ds\>\"", "]"}]}], ";", "\[IndentingNewLine]", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{"!", 
                    RowBox[{"KeyExistsQ", "[", 
                    RowBox[{"ListDis", ",", "test"}], "]"}]}], ",", 
                   "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"ListDis", "[", "test", "]"}], "=", 
                    RowBox[{"{", 
                    RowBox[{"{", 
                    RowBox[{"i", ",", "j"}], "}"}], "}"}]}], ";"}], 
                   "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{"AppendTo", "[", 
                    RowBox[{
                    RowBox[{"ListDis", "[", "test", "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"i", ",", "j"}], "}"}]}], "]"}], ";"}]}], 
                  "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", ",", 
                "\[IndentingNewLine]", 
                RowBox[{"{", 
                 RowBox[{"j", ",", 
                  RowBox[{
                   RowBox[{"bonds", "[", "i", "]"}], "[", "\"\<dt\>\"", 
                   "]"}]}], "}"}]}], "\[IndentingNewLine]", "]"}], 
              "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
              RowBox[{"{", 
               RowBox[{"i", ",", "objs"}], "}"}]}], "\[IndentingNewLine]", 
             "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"AQLIST", "=", 
             RowBox[{"Join", "[", 
              RowBox[{
               RowBox[{"{", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"Er", "[", 
                  RowBox[{
                   FractionBox[
                    RowBox[{"\[Kappa]", " ", "e2", " ", 
                    RowBox[{"dIon", "[", 
                    RowBox[{"io", ",", "i1q"}], "]"}]}], "unit"], ",", 
                   RowBox[{"molecule", "[", "\"\<ei\>\"", "]"}]}], "]"}], 
                 "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"molecule", "[", "\"\<dm\>\"", "]"}], 
                    "\[NotEqual]", "0"}], ",", "\[IndentingNewLine]", 
                   RowBox[{"Er", "[", 
                    RowBox[{
                    RowBox[{"e1", " ", "unit", " ", 
                    RowBox[{"dDim", "[", "pq", "]"}]}], ",", 
                    RowBox[{"molecule", "[", "\"\<dm\>\"", "]"}]}], "]"}], 
                   "\[IndentingNewLine]", ",", "\[IndentingNewLine]", "0"}], 
                  "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
                "}"}], "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
               RowBox[{"Table", "[", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"Er", "[", 
                  RowBox[{
                   FractionBox[
                    RowBox[{"\[Kappa]", " ", "e2", " ", 
                    RowBox[{"dDis", "[", 
                    RowBox[{
                    RowBox[{"KER", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", "dq"}], "]"}]}], 
                    "unit"], ",", "i"}], "]"}], "\[IndentingNewLine]", ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{"{", 
                  RowBox[{"i", ",", 
                   RowBox[{"Keys", "[", "ListDis", "]"}]}], "}"}]}], 
                "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
              "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"EQ", "=", 
             RowBox[{"TotPow", "[", 
              RowBox[{"AQLIST", ",", "2"}], "]"}]}], ";"}]}], 
          "\[IndentingNewLine]"}]}]}]}]}]}]}]}], ")"}]], "Input",
 CellChangeTimes->{{3.7858455945463743`*^9, 3.7858456249849734`*^9}, 
   3.7858459504236603`*^9, {3.785846054449542*^9, 3.7858460552105026`*^9}, 
   3.785846218237547*^9, {3.785846827972937*^9, 3.7858468621605186`*^9}, {
   3.7858468949049544`*^9, 3.7858469256297894`*^9}, {3.7858475347539015`*^9, 
   3.7858475378187017`*^9}, {3.7858477084925756`*^9, 3.785847761387126*^9}, {
   3.785847865924664*^9, 3.785847867457567*^9}, {3.785849861770385*^9, 
   3.785849864291664*^9}, 3.7858500192914934`*^9, {3.7858500759260445`*^9, 
   3.785850076223256*^9}, {3.7858508358683925`*^9, 3.7858508924800053`*^9}, {
   3.785851069374954*^9, 3.785851080100239*^9}, {3.785851265149413*^9, 
   3.785851349260481*^9}, {3.7858513853360105`*^9, 3.7858515075990615`*^9}, {
   3.785851559828391*^9, 3.785851560821735*^9}, {3.7858516653591814`*^9, 
   3.7858516674016867`*^9}, {3.7858518195249133`*^9, 3.78585186897966*^9}, 
   3.78585212568718*^9, {3.7858521653710575`*^9, 3.7858521675592055`*^9}, {
   3.7858522016839495`*^9, 3.78585222167648*^9}, {3.7858522778033924`*^9, 
   3.7858523051472635`*^9}, {3.785852577396217*^9, 3.7858526154175496`*^9}, {
   3.785852693989435*^9, 3.7858527286018476`*^9}, {3.785852766029784*^9, 
   3.785852803791802*^9}, {3.785852895916444*^9, 3.785852898466625*^9}, {
   3.785852981054738*^9, 3.785853003310256*^9}, {3.785853088027672*^9, 
   3.7858530973198557`*^9}, {3.7858532193983965`*^9, 3.785853224314251*^9}, {
   3.7858533078549814`*^9, 3.785853349901573*^9}, {3.785853527731435*^9, 
   3.7858535295066824`*^9}, {3.785853679054764*^9, 3.7858536794815903`*^9}, {
   3.7858538395552464`*^9, 3.7858538444421787`*^9}, 3.785854245472313*^9, {
   3.7858548981340256`*^9, 3.785854903049873*^9}, 3.7858550482867765`*^9, {
   3.785855282905439*^9, 3.785855324022483*^9}, {3.7858554843487763`*^9, 
   3.785855517966874*^9}, 3.7858555575496597`*^9, {3.785855651800573*^9, 
   3.785855653760332*^9}, 3.785855728570171*^9, 3.7858560676174774`*^9, 
   3.785856174072769*^9, 3.7858563611693864`*^9, 3.785905451302394*^9, {
   3.785906405743151*^9, 3.7859064163228607`*^9}, {3.785906781766385*^9, 
   3.785906806905151*^9}, 3.785906920582177*^9, {3.785906975436487*^9, 
   3.7859069989745398`*^9}, {3.7859070385148044`*^9, 3.785907041132801*^9}, {
   3.78590840831363*^9, 3.7859084103771076`*^9}, {3.7859085753770857`*^9, 
   3.7859085754468994`*^9}, 3.7859086280900908`*^9, {3.7859090702875757`*^9, 
   3.7859090798580055`*^9}, {3.7859138698982167`*^9, 3.785913909524251*^9}, {
   3.785914086668974*^9, 3.7859140909984207`*^9}, 3.785914244769935*^9, 
   3.785915307425039*^9, {3.7878080486159105`*^9, 3.7878080787338324`*^9}, {
   3.7878084144206715`*^9, 3.7878084613157587`*^9}, {3.7878086244775853`*^9, 
   3.787808648909342*^9}, {3.787808706603739*^9, 3.787808710462211*^9}, 
   3.787808763996499*^9, {3.7878088008159657`*^9, 3.787808804518223*^9}, {
   3.7878089033699846`*^9, 3.787808935971696*^9}, {3.787808966230338*^9, 
   3.787808993817467*^9}, {3.787809082202937*^9, 3.7878092029235597`*^9}, {
   3.7878092371655097`*^9, 3.7878092656365547`*^9}, {3.7878093124536996`*^9, 
   3.787809410254265*^9}, {3.7878094741830244`*^9, 3.787809531095544*^9}, {
   3.787809684234806*^9, 3.787809689795863*^9}, {3.7878098431187315`*^9, 
   3.7878098448214507`*^9}, {3.7878109583534956`*^9, 3.7878109611651955`*^9}, 
   3.787811053943948*^9, {3.787812347842301*^9, 3.7878123484177403`*^9}, {
   3.7878126844224253`*^9, 3.7878126847156377`*^9}, 3.787812895572809*^9, {
   3.7878134348562517`*^9, 3.7878134842860646`*^9}, {3.787813707486189*^9, 
   3.7878137442907677`*^9}, {3.7878141133568172`*^9, 
   3.7878141728058395`*^9}, {3.7878142210228977`*^9, 
   3.7878143133928833`*^9}, {3.787814580893538*^9, 3.787814619093384*^9}, {
   3.787814868973156*^9, 3.7878151074893236`*^9}, {3.7878153458199806`*^9, 
   3.787815349862172*^9}, {3.7878154389080486`*^9, 3.7878155040149417`*^9}, {
   3.7878155393235197`*^9, 3.787815539863076*^9}, {3.7878157756168365`*^9, 
   3.7878157956492662`*^9}, {3.7878159248417816`*^9, 
   3.7878159636719418`*^9}, {3.7878159967145805`*^9, 
   3.7878159981747046`*^9}, {3.7878161699248133`*^9, 3.78781617810992*^9}, {
   3.787816666339549*^9, 3.7878166708784122`*^9}, 3.787816790813682*^9, {
   3.7878168788422785`*^9, 3.787816879068673*^9}, {3.7879865955011826`*^9, 
   3.787986605853532*^9}, {3.787986761934795*^9, 3.78798683306231*^9}, {
   3.7879877404256706`*^9, 3.78798774555523*^9}, {3.7879879114499297`*^9, 
   3.7879879366422586`*^9}, {3.7880097563707647`*^9, 3.788009792054341*^9}, {
   3.7880664950639563`*^9, 3.788066496164015*^9}, 3.788072701598955*^9, 
   3.78807304205043*^9, {3.78807741611591*^9, 3.788077433495434*^9}, 
   3.7880775285128694`*^9, {3.788077805689285*^9, 3.7880778059795065`*^9}, {
   3.7880779110632834`*^9, 3.7880779159761295`*^9}, {3.78807795377205*^9, 
   3.788077957572884*^9}, {3.7880782940424013`*^9, 3.7880782983597403`*^9}, {
   3.7880783820559287`*^9, 3.7880783835050526`*^9}, {3.78954584675001*^9, 
   3.789545847312539*^9}, {3.789545889099975*^9, 3.7895459103471565`*^9}, {
   3.789545946979171*^9, 3.789545947213546*^9}, {3.789545997455036*^9, 
   3.7895459986757717`*^9}, {3.78954604142043*^9, 3.789546049442978*^9}, {
   3.7895460860501056`*^9, 3.789546125302*^9}, {3.789546342565693*^9, 
   3.789546516754649*^9}, {3.7895465508185587`*^9, 3.7895466040819874`*^9}, {
   3.789546661155361*^9, 3.7895466686353507`*^9}, {3.789546896255988*^9, 
   3.789546935982751*^9}, {3.789547074022634*^9, 3.7895471092763247`*^9}, {
   3.789547147388443*^9, 3.7895473499977617`*^9}, 3.789547521685707*^9, {
   3.789547597754261*^9, 3.789547704362576*^9}, {3.7895477498180127`*^9, 
   3.7895477641387167`*^9}, {3.789548515281926*^9, 3.7895485186060596`*^9}, {
   3.789548650254137*^9, 3.789548696691957*^9}, {3.7897350982963057`*^9, 
   3.789735132627861*^9}, {3.789735619781474*^9, 3.7897356202352605`*^9}, {
   3.789737004587658*^9, 3.789737011066332*^9}, {3.7897370732450056`*^9, 
   3.7897370910783234`*^9}, {3.789737131988679*^9, 3.789737171691105*^9}, 
   3.7897374803726664`*^9, {3.789737523531293*^9, 3.7897375505231185`*^9}, {
   3.7897379157308083`*^9, 3.789737921152311*^9}, {3.7897380616757803`*^9, 
   3.7897380619809694`*^9}, {3.7897382020279207`*^9, 
   3.7897382074260445`*^9}, {3.7897389492661076`*^9, 
   3.7897389625000367`*^9}, {3.7897389929412165`*^9, 
   3.7897390113629613`*^9}, {3.7897391891622167`*^9, 
   3.7897391894644136`*^9}, {3.7897940949754515`*^9, 3.789794099344702*^9}, {
   3.790234117683085*^9, 3.790234160836684*^9}, {3.790234235505328*^9, 
   3.7902342665902014`*^9}, {3.7902343356744256`*^9, 3.790234375070074*^9}, {
   3.790234527085889*^9, 3.7902346550568485`*^9}, {3.7902364006895356`*^9, 
   3.7902364110897236`*^9}, 3.790238759492727*^9, {3.790239228295586*^9, 
   3.790239341409566*^9}, {3.790349130321041*^9, 3.790349130930064*^9}, 
   3.7903497966466084`*^9, 3.7903974776547575`*^9, 3.790577811238227*^9, {
   3.79187793459087*^9, 3.7918779862198524`*^9}, {3.791878081247753*^9, 
   3.791878081581839*^9}, {3.7918782475979385`*^9, 3.7918782749288597`*^9}, {
   3.792049256665658*^9, 3.7920493690721216`*^9}, {3.7920494009718046`*^9, 
   3.7920495498048477`*^9}, {3.792049669271413*^9, 3.792049669588567*^9}, {
   3.792049709260489*^9, 3.7920497277081633`*^9}, {3.7920497633349037`*^9, 
   3.7920497815821123`*^9}, {3.7920498476025867`*^9, 3.79204988521302*^9}, {
   3.792049965271955*^9, 3.792050020916171*^9}, {3.7920500794027896`*^9, 
   3.7920501773848023`*^9}, {3.792050717442832*^9, 3.7920507237669163`*^9}, 
   3.7920507620515566`*^9, {3.792051157852481*^9, 3.7920511901032257`*^9}, {
   3.7920514482310357`*^9, 3.7920514582003775`*^9}, {3.792052218133464*^9, 
   3.792052245706736*^9}, 3.792052456432294*^9, {3.7920525894915032`*^9, 
   3.7920526952158194`*^9}, {3.792052736504119*^9, 3.7920527384349794`*^9}, {
   3.7920527714586535`*^9, 3.792052773973956*^9}, {3.792052818774169*^9, 
   3.7920528520292573`*^9}, {3.792052918849583*^9, 3.7920530263830547`*^9}, {
   3.7920532324849443`*^9, 3.7920533250105295`*^9}, {3.792053400011243*^9, 
   3.792053556251458*^9}, {3.792053668261958*^9, 3.7920536904546394`*^9}, {
   3.7920537707798405`*^9, 3.7920537709633484`*^9}, {3.792053922360536*^9, 
   3.792053948454767*^9}, {3.792053994369029*^9, 3.7920540169526405`*^9}, {
   3.7920541602375174`*^9, 3.7920541701220617`*^9}, {3.792054212534692*^9, 
   3.792054215646368*^9}, {3.792054257850525*^9, 3.792054269334782*^9}, {
   3.7920543698041434`*^9, 3.7920544019741507`*^9}, {3.792161739670377*^9, 
   3.792161780124892*^9}, {3.7921619776605015`*^9, 3.7921619946200542`*^9}, {
   3.792162025253602*^9, 3.792162068809169*^9}, {3.792162108614279*^9, 
   3.792162155597509*^9}, {3.79216227292402*^9, 3.7921622749784575`*^9}, {
   3.792162340493395*^9, 3.792162365956152*^9}, {3.7921623989419756`*^9, 
   3.7921625083483553`*^9}, {3.7921626080513105`*^9, 
   3.7921626080747347`*^9}, {3.792162668811651*^9, 3.792162681347413*^9}, {
   3.7921630021210833`*^9, 3.7921630568026276`*^9}, {3.79216318777241*^9, 
   3.792163188498248*^9}, {3.7921632345635242`*^9, 3.7921632974181695`*^9}, {
   3.792163416594739*^9, 3.7921634171695356`*^9}, {3.792163544489494*^9, 
   3.792163663131275*^9}, {3.792163699993477*^9, 3.7921637778294187`*^9}, {
   3.7921638223469996`*^9, 3.7921638584960546`*^9}, {3.79216391448921*^9, 
   3.792163972808256*^9}, 3.792164872826486*^9, {3.7922152953139553`*^9, 
   3.792215306814205*^9}, {3.7922156471073184`*^9, 3.7922156486522174`*^9}, {
   3.7922160585959835`*^9, 3.792216063224574*^9}, {3.7922160992911377`*^9, 
   3.7922161219714937`*^9}, {3.7922162898239436`*^9, 3.792216293111158*^9}, 
   3.792217057280614*^9, 3.792217087655409*^9, {3.7922174508897934`*^9, 
   3.792217458979164*^9}, {3.7922174972468095`*^9, 3.7922175190654993`*^9}, {
   3.7922175622888966`*^9, 3.792217624923448*^9}, {3.7922176816048985`*^9, 
   3.7922177242099466`*^9}, {3.792217855092985*^9, 3.7922179451215906`*^9}, {
   3.7922181844716034`*^9, 3.792218219783185*^9}, {3.7922184288372188`*^9, 
   3.79221844175268*^9}, {3.792218939279376*^9, 3.792219001537198*^9}, {
   3.792219080719511*^9, 3.7922191029649973`*^9}, {3.7922191401824827`*^9, 
   3.7922191692328067`*^9}, {3.7922192080530076`*^9, 3.792219309466843*^9}, {
   3.7922193460510235`*^9, 3.79221942153522*^9}, {3.792219916692129*^9, 
   3.7922199371843367`*^9}, {3.792220057509612*^9, 3.792220059575082*^9}, {
   3.7922201588699913`*^9, 3.792220161363327*^9}, 3.7922202499653854`*^9, 
   3.7922205397561607`*^9, {3.7922205807785*^9, 3.792220600636404*^9}, {
   3.7922206942251673`*^9, 3.7922206946340694`*^9}, {3.79222075248938*^9, 
   3.7922208154260883`*^9}, {3.7922209187886877`*^9, 
   3.7922209866023655`*^9}, {3.7922210790013046`*^9, 
   3.7922211896893663`*^9}, {3.7922212198905888`*^9, 
   3.7922212249441104`*^9}, {3.7922212662027884`*^9, 3.792221434496767*^9}, {
   3.792221468976574*^9, 3.792221538905631*^9}, {3.7922216109030704`*^9, 
   3.7922216714102836`*^9}, {3.792222960732912*^9, 3.7922229894969983`*^9}, 
   3.79222303099504*^9, {3.7922231651934423`*^9, 3.7922231658806057`*^9}, {
   3.7922232001858764`*^9, 3.792223234550991*^9}, {3.792223825541256*^9, 
   3.792223885877967*^9}, {3.79222392227661*^9, 3.79222392764219*^9}, {
   3.792308765891704*^9, 3.7923088325105762`*^9}, 3.792315338224061*^9, {
   3.792318086335363*^9, 3.792318202473218*^9}, {3.7923182340114756`*^9, 
   3.7923182369256563`*^9}, {3.7923182792684593`*^9, 3.792318307393261*^9}, {
   3.7923183431556144`*^9, 3.7923183434608345`*^9}, {3.792318387995241*^9, 
   3.792318424605365*^9}, {3.7923184746148977`*^9, 3.7923185407560472`*^9}, {
   3.7923186467974553`*^9, 3.79231865630606*^9}, {3.7923187910958548`*^9, 
   3.792318929092824*^9}, 3.7923189892738633`*^9, {3.7923190820431676`*^9, 
   3.7923190930048566`*^9}, {3.7923192497071753`*^9, 3.792319301373625*^9}, {
   3.7923194093487487`*^9, 3.7923194412779446`*^9}, {3.7923197653146906`*^9, 
   3.792319843402567*^9}},ExpressionUUID->"382477af-70a4-4ec5-bbfb-\
35d9ce9dbfaf"]
},
WindowSize->{1143, 854},
WindowMargins->{{372, Automatic}, {10, Automatic}},
FrontEndVersion->"11.3 for Microsoft Windows (64-bit) (March 6, 2018)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 38229, 720, 4350, "Input",ExpressionUUID->"382477af-70a4-4ec5-bbfb-35d9ce9dbfaf"]
}
]
*)

